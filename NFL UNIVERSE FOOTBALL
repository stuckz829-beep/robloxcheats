-- Updated 2026 Loader with Noclip & Auto-Pull
getgenv().SecureMode = true 
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Ultimate Football Hub 2026",
   LoadingTitle = "Direct Path Logic Applied...",
   LoadingSubtitle = "by 2026 Stable Loader",
   ConfigurationSaving = { Enabled = false },
   KeySystem = false
})

-- Variables
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local localPlayer = Players.LocalPlayer

local isHeadModEnabled, targetHeadScale = false, 1
local isMagEnabled, magRange = false, 15
local isNoclipEnabled = false
local visualSphere, currentBall = nil, nil

-- OPTIMIZATION: Search for ball every 0.5s
task.spawn(function()
    while task.wait(0.5) do
        currentBall = workspace:FindFirstChild("Football", true) or workspace:FindFirstChild("Ball", true)
    end
end)

-- CORE LOGIC LOOP
RunService.Stepped:Connect(function()
    local char = localPlayer.Character
    if not char then return end

    -- 1. NOCLIP LOGIC
    if isNoclipEnabled then
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end

    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    -- 2. POSSESSION CHECK (Don't pull if someone has it)
    local function isHeldByOthers()
        if not currentBall then return false end
        local parent = currentBall.Parent
        if parent:FindFirstChildOfClass("Humanoid") and parent ~= char then return true end
        local weld = currentBall:FindFirstChildWhichIsA("Weld") or currentBall:FindFirstChildWhichIsA("ManualWeld")
        if weld and weld.Part0 then
            local potentialChar = weld.Part0:FindFirstAncestorOfClass("Model")
            if potentialChar and potentialChar:FindFirstChildOfClass("Humanoid") and potentialChar ~= char then
                return true
            end
        end
        return false
    end

    -- 3. AUTOMATIC MAGNET LOGIC
    if currentBall and isMagEnabled and not isHeldByOthers() then
        -- Sphere Visualization
        if not visualSphere then
            visualSphere = Instance.new("Part")
            visualSphere.Shape, visualSphere.Color = Enum.PartType.Ball, Color3.fromRGB(0, 255, 150)
            visualSphere.Transparency, visualSphere.Material = 0.7, Enum.Material.ForceField
            visualSphere.CanCollide, visualSphere.Anchored, visualSphere.CastShadow = false, true, false
            visualSphere.Parent = workspace
        end
        visualSphere.Size = Vector3.new(magRange * 2, magRange * 2, magRange * 2)
        visualSphere.Position = currentBall.Position

        local dist = (hrp.Position - currentBall.Position).Magnitude
        if dist <= magRange then
            local catchPoint = hrp.Position + (hrp.CFrame.LookVector * 1.5)
            
            -- Direct Path Pull
            if dist > 2.5 then
                currentBall.CFrame = currentBall.CFrame:Lerp(CFrame.new(catchPoint), 0.3)
                currentBall.AssemblyLinearVelocity = (catchPoint - currentBall.Position).Unit * 150
            else
                currentBall.CFrame = CFrame.new(catchPoint)
                currentBall.AssemblyLinearVelocity = Vector3.new(0,0,0)
            end
        end
    elseif visualSphere then
        visualSphere:Destroy()
        visualSphere = nil
    end

    -- 2. Integrated Persistent Head Collision Logic
    if isHeadModEnabled then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= localPlayer and player.Character then
                local head = player.Character:FindFirstChild("Head")
                local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
                
                if head and humanoid then
                    head.Size = Vector3.new(targetHeadScale, targetHeadScale, targetHeadScale)
                    head.Transparency = 0.5
                    
                    local isStandingOnHead = false
                    local rayParam = RaycastParams.new()
                    rayParam.FilterDescendantsInstances = {char}
                    rayParam.FilterType = Enum.RaycastFilterType.Exclude
                    
                    local ray = workspace:Raycast(hrp.Position, Vector3.new(0, -5, 0), rayParam)
                    if ray and ray.Instance == head then
                        isStandingOnHead = true
                    end

                    local lastJump = humanoid:GetAttribute("LastJumpTime") or 0
                    local timeSinceJump = tick() - lastJump

                    head.CanCollide = (isStandingOnHead or (timeSinceJump > 0.15 and timeSinceJump < 0.30))
                end
            end
        end
    end
end)

-- TABS
local MainTab = Window:CreateTab("All Mods", 4483362458)

MainTab:CreateSection("Player")
MainTab:CreateToggle({Name = "Noclip", CurrentValue = false, Callback = function(v) isNoclipEnabled = v end})
MainTab:CreateSlider({Name = "WalkSpeed", Range = {18, 300}, Increment = 1, Suffix = "Speed", CurrentValue = 18, Callback = function(v) if localPlayer.Character:FindFirstChild("Humanoid") then localPlayer.Character.Humanoid.WalkSpeed = v end end})

MainTab:CreateSection("Football Magnet")
MainTab:CreateToggle({Name = "Auto-Pull Football", CurrentValue = false, Callback = function(v) isMagEnabled = v end})
MainTab:CreateSlider({Name = "Magnet Range", Range = {5, 100}, Increment = 1, Suffix = "Studs", CurrentValue = 15, Callback = function(v) magRange = v end})

MainTab:CreateSection("Server Visuals")
MainTab:CreateToggle({Name = "Enable Head Size", CurrentValue = false, Callback = function(v) isHeadModEnabled = v end})
MainTab:CreateSlider({Name = "Head Scale", Range = {1, 15}, Increment = 0.5, CurrentValue = 1, Callback = function(v) targetHeadScale = v end})

Rayfield:Notify({Title = "Hub Loaded", Content = "Auto-Pull & Noclip Active", Duration = 5})
