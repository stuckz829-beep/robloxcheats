-- Ultimate Football Hub 2026
getgenv().SecureMode = true

-- Load Rayfield
local success, Rayfield = pcall(function()
    return loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
end)
if not success then
    warn("Failed to load Rayfield GUI!")
    return
end

-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local localPlayer = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- VARIABLES
local isHeadModEnabled, targetHeadScale = false, 5
local isBounceEnabled, bouncePower = false, 30
local isMagEnabled, magRange = false, 0.3
local isNoclipEnabled = false
local isFlying, flySpeed = false, 50
local flyVelocity = Vector3.zero
local flyAccel, flyFriction = 8, 6

local currentBall = nil
local isPulling = false
local HEAD_BOUNCE_COOLDOWN = 1.2
local headBounceCooldowns = {}

-- AUTO RUSHER VARIABLES
local isAutoRusherEnabled = false
local autoRusherKey = Enum.KeyCode.Q
local rusherHolding = false
local defaultWalkSpeed = 18 

-- BALL SEARCH
task.spawn(function()
    while task.wait(0.5) do
        currentBall = workspace:FindFirstChild("Football", true)
            or workspace:FindFirstChild("Ball", true)
    end
end)

-- INPUT HANDLER
UIS.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isPulling = true
    elseif input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == autoRusherKey then
            rusherHolding = true
        end
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isPulling = false
    elseif input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == autoRusherKey then
            rusherHolding = false
        end
    end
end)

-- HEAD & PHYSICS MANAGER (CONDITION-BASED BOOST)
task.spawn(function()
    while task.wait(0.1) do
        -- Check if ball is physically in the workspace (not held)
        local footballInWorkspace = workspace:FindFirstChild("Football") or workspace:FindFirstChild("Ball")
        local ballHeldBySomeone = false

        if not footballInWorkspace and currentBall and currentBall.Parent then
            if currentBall.Parent:FindFirstChildOfClass("Humanoid") then
                ballHeldBySomeone = true
            end
        end

        for _, player in ipairs(Players:GetPlayers()) do
            if player.Character and player ~= localPlayer then
                local head = player.Character:FindFirstChild("Head")
                local hrp = player.Character:FindFirstChild("HumanoidRootPart")
                
                if head and hrp then
                    -- Store Original Size
                    if not head:FindFirstChild("OriginalY") then
                        local v = Instance.new("NumberValue", head)
                        v.Name = "OriginalY"
                        v.Value = head.Size.Y
                    end

                    -- 1. Scaling Logic (Always scales if enabled)
                    if isHeadModEnabled then
                        head.Size = Vector3.new(targetHeadScale, head.OriginalY.Value, targetHeadScale)
                        head.Transparency = 0.5
                    else
                        head.Size = Vector3.new(1, head.OriginalY.Value, 1)
                        head.Transparency = 0
                    end

                    -- 2. Conditional Collision & Boost
                    -- ONLY allows collision and boost if the ball is NOT held
                    if not ballHeldBySomeone and isHeadModEnabled then
                        head.CanCollide = true
                        
                        -- Boost Trigger logic
                        if isBounceEnabled then
                            local myChar = localPlayer.Character
                            if myChar and myChar:FindFirstChild("HumanoidRootPart") then
                                local myHRP = myChar.HumanoidRootPart
                                local dist = (myHRP.Position - head.Position).Magnitude
                                local verticalVel = myHRP.AssemblyLinearVelocity.Y
                                local now = tick()
                                local last = headBounceCooldowns[player] or 0

                                -- Trigger only if falling, close to head, and off cooldown
                                if dist <= (targetHeadScale + 2.5) and verticalVel < -5 and (now - last >= HEAD_BOUNCE_COOLDOWN) then
                                    headBounceCooldowns[player] = now
                                    myHRP.AssemblyLinearVelocity = Vector3.new(
                                        myHRP.AssemblyLinearVelocity.X,
                                        bouncePower,
                                        myHRP.AssemblyLinearVelocity.Z
                                    )
                                end
                            end
                        end
                    else
                        -- Disable collision if ball is held or mod is off
                        head.CanCollide = false
                    end
                end
            end
        end
    end
end)

-- CORE LOOP
RunService.Stepped:Connect(function(_, delta)
    local char = localPlayer.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hrp or not hum then return end

    if isNoclipEnabled then
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end

    if currentBall and isMagEnabled and isPulling then
        if not currentBall.Parent:FindFirstChildOfClass("Humanoid") then
            hrp.CFrame = hrp.CFrame:Lerp(CFrame.new(currentBall.Position), (magRange ^ 3) * 0.05)
        end
    end

    if isFlying then
        hum:ChangeState(Enum.HumanoidStateType.Physics)
        local moveDir = Vector3.zero
        if UIS:IsKeyDown(Enum.KeyCode.W) then moveDir += camera.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.S) then moveDir -= camera.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.A) then moveDir -= camera.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.D) then moveDir += camera.CFrame.RightVector end
        
        if moveDir.Magnitude > 0 then
            flyVelocity = flyVelocity:Lerp(moveDir.Unit * flySpeed, flyAccel * delta)
        else
            flyVelocity = flyVelocity:Lerp(Vector3.zero, flyFriction * delta)
        end
        hrp.AssemblyLinearVelocity = flyVelocity
    end

    if isAutoRusherEnabled and rusherHolding and currentBall and currentBall.Parent then
        local ballOwner = currentBall.Parent:FindFirstChildOfClass("Humanoid") and currentBall.Parent
        if ballOwner and ballOwner ~= char then
            local targetHRP = ballOwner:FindFirstChild("HumanoidRootPart")
            if targetHRP then
                hum:Move((targetHRP.Position - hrp.Position).Unit, false)
            end
        end
    end
end)

-- GUI SETUP
local Window = Rayfield:CreateWindow({
    Name = "Ultimate Football Hub 2026",
    LoadingTitle = "NFL Universe Loader",
    LoadingSubtitle = "Condition-Sync Active",
    ConfigurationSaving = { Enabled = true },
    KeySystem = false
})

local PhysicsTab = Window:CreateTab("Player Physics")
local MagnetTab = Window:CreateTab("Player Magnet")
local HeadTab = Window:CreateTab("Head Mod & Boost")
local FlightTab = Window:CreateTab("Flight")
local RusherTab = Window:CreateTab("Auto Rusher")

-- Physics Section
PhysicsTab:CreateSlider({
    Name = "Gravity",
    Range = {1, 196.2},
    Increment = 1,
    CurrentValue = 196.2,
    Callback = function(v) workspace.Gravity = v end
})

PhysicsTab:CreateSlider({
    Name = "WalkSpeed",
    Range = {18, 200},
    Increment = 1,
    CurrentValue = 18,
    Callback = function(v) 
        local hum = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum.WalkSpeed = v end 
    end
})

PhysicsTab:CreateToggle({Name = "Noclip", CurrentValue = false, Callback = function(v) isNoclipEnabled = v end})

-- Magnet Section
MagnetTab:CreateToggle({Name = "Enable Pull Mag", CurrentValue = false, Callback = function(v) isMagEnabled = v end})
MagnetTab:CreateSlider({Name = "Pull Strength", Range = {0.1, 1}, Increment = 0.05, CurrentValue = 0.3, Callback = function(v) magRange = v end})

-- Head & Boost Section
HeadTab:CreateToggle({Name = "Enable Head Size", CurrentValue = false, Callback = function(v) isHeadModEnabled = v end})
HeadTab:CreateSlider({Name = "Head Size", Range = {1, 15}, Increment = 0.5, CurrentValue = 5, Callback = function(v) targetHeadScale = v end})
HeadTab:CreateSection("Boost Tech")
HeadTab:CreateLabel("Boost only works when the ball is on the ground.")
HeadTab:CreateToggle({Name = "Enable Boost Tech", CurrentValue = false, Callback = function(v) isBounceEnabled = v end})
HeadTab:CreateSlider({
    Name = "Boost Power",
    Range = {30, 150},
    Increment = 5,
    CurrentValue = 30,
    Callback = function(v) bouncePower = v end
})

-- Flight Section
FlightTab:CreateToggle({Name = "Enable Flight", CurrentValue = false, Callback = function(v) isFlying = v end})
FlightTab:CreateSlider({Name = "Flight Speed", Range = {10, 200}, Increment = 5, CurrentValue = 50, Callback = function(v) flySpeed = v end})

-- Auto Rusher Section
RusherTab:CreateToggle({Name = "Enable Auto Rusher", CurrentValue = false, Callback = function(v) isAutoRusherEnabled = v end})
RusherTab:CreateKeybind({
    Name = "Auto Rusher Keybind",
    CurrentKeybind = "Q",
    HoldToInteract = false,
    Flag = "RusherKey",
    Callback = function(Key) autoRusherKey = Key end,
})

Rayfield:Notify({Title = "Loaded", Content = "Boost synced to ball location.", Duration = 5})
