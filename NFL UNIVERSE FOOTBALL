-- Ultimate Football Hub 2026
getgenv().SecureMode = true

-- Load Rayfield
local success, Rayfield = pcall(function()
    return loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
end)
if not success then
    warn("Failed to load Rayfield GUI!")
    return
end

-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local localPlayer = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- VARIABLES
local isHeadModEnabled, targetHeadScale = false, 5
local isBounceEnabled, bouncePower = false, 50
local isMagEnabled, magRange = false, 0.5
local isNoclipEnabled = false
local isFlying, flySpeed = false, 50
local flyVelocity = Vector3.zero
local flyAccel, flyFriction = 8, 6

local currentBall = nil
local isPulling = false
local HEAD_BOUNCE_COOLDOWN = 3
local headBounceCooldowns = {}
local isTouchingHead = {}

-- AUTO RUSHER VARIABLES
local isAutoRusherEnabled = false
local autoRusherKey = Enum.KeyCode.Q
local rusherHolding = false
local defaultWalkSpeed = 18 -- default value to reset

-- BALL SEARCH
task.spawn(function()
    while task.wait(0.5) do
        currentBall = workspace:FindFirstChild("Football", true)
            or workspace:FindFirstChild("Ball", true)
    end
end)

-- INPUT
UIS.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isPulling = true
    elseif input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == autoRusherKey then
            rusherHolding = true
        end
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isPulling = false
    elseif input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == autoRusherKey then
            rusherHolding = false
        end
    end
end)

-- CORE LOOP
RunService.Stepped:Connect(function(_, delta)
    local char = localPlayer.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hrp or not hum then return end

    -- NOCLIP
    if isNoclipEnabled then
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end

    -- PLAYER PULL
    if currentBall and isMagEnabled and isPulling then
        local parent = currentBall.Parent
        if parent and not parent:FindFirstChildOfClass("Humanoid") then
            local direction = currentBall.Position - hrp.Position
            if direction.Magnitude > 0.1 then
                local speedFactor = (magRange ^ 3) * 0.05
                hrp.CFrame = hrp.CFrame:Lerp(CFrame.new(currentBall.Position), speedFactor)
            end
        end
    end

-- 2. Integrated Persistent Head Collision Logic
if isHeadModEnabled then
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Character then
            local head = player.Character:FindFirstChild("Head")
            local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
            local char2 = player.Character

            if head and humanoid and char2 then
                -- Store original Y size once
                if not head:FindFirstChild("OriginalY") then
                    local v = Instance.new("NumberValue")
                    v.Name = "OriginalY"
                    v.Value = head.Size.Y
                    v.Parent = head
                end

                -- Expand head in XZ (keep original Y)
                head.Size = Vector3.new(targetHeadScale, head.OriginalY.Value, targetHeadScale)
                head.Transparency = 0.5

                -- BOOST TECH
                if isBounceEnabled then
                    local dist = (hrp.Position - head.Position).Magnitude
                    local verticalVel = hrp.AssemblyLinearVelocity.Y
                    local now = tick()
                    local last = headBounceCooldowns[player] or 0

                    if dist <= 5 and verticalVel < 0 and (now - last >= HEAD_BOUNCE_COOLDOWN) and not isTouchingHead[player] then
                        isTouchingHead[player] = true
                        headBounceCooldowns[player] = now

                        task.spawn(function()
                            task.wait(0.15)
                            if head and hrp and (hrp.Position - head.Position).Magnitude <= 5 then
                                hrp.AssemblyLinearVelocity = Vector3.new(
                                    hrp.AssemblyLinearVelocity.X,
                                    bouncePower,
                                    hrp.AssemblyLinearVelocity.Z
                                )
                            end
                            isTouchingHead[player] = false
                        end)
                    end
                end

                -- PERSISTENT COLLISION USING RAYCAST + JUMP TIMER
                local isStandingOnHead = false
                local rayParam = RaycastParams.new()
                rayParam.FilterDescendantsInstances = {char}
                rayParam.FilterType = Enum.RaycastFilterType.Exclude

                -- Cast a ray straight down from your HRP to check if standing on this player's head
                local ray = workspace:Raycast(hrp.Position, Vector3.new(0, -5, 0), rayParam)
                if ray and ray.Instance == head then
                    isStandingOnHead = true
                end

                local lastJump = humanoid:GetAttribute("LastJumpTime") or 0
                local timeSinceJump = tick() - lastJump

                -- Always update CanCollide per player
                head.CanCollide = (isStandingOnHead or (timeSinceJump > 0.15 and timeSinceJump < 0.30))
            end
        end
    end
elseif not isHeadModEnabled then
    -- Reset all other players' heads when toggle is off
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Character then
            local head = player.Character:FindFirstChild("Head")
            if head and head:FindFirstChild("OriginalY") then
                head.Size = Vector3.new(1, head.OriginalY.Value, 1)
                head.Transparency = 0
                head.CanCollide = true
            end
        end
    end
end


    -- SMOOTH FLIGHT
    if isFlying then
        hum:ChangeState(Enum.HumanoidStateType.Physics)
        local moveDir = Vector3.zero
        if UIS:IsKeyDown(Enum.KeyCode.W) then moveDir += camera.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.S) then moveDir -= camera.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.A) then moveDir -= camera.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.D) then moveDir += camera.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.Space) then moveDir += Vector3.new(0,1,0) end
        if UIS:IsKeyDown(Enum.KeyCode.LeftControl) then moveDir -= Vector3.new(0,1,0) end

        if moveDir.Magnitude > 0 then
            flyVelocity = flyVelocity:Lerp(moveDir.Unit * flySpeed, flyAccel * delta)
        else
            flyVelocity = flyVelocity:Lerp(Vector3.zero, flyFriction * delta)
        end
        hrp.AssemblyLinearVelocity = flyVelocity
    else
        flyVelocity = Vector3.zero
    end

    -- AUTO RUSHER
    if isAutoRusherEnabled and rusherHolding and currentBall and currentBall.Parent then
        local ballOwnerChar = currentBall.Parent:FindFirstChildOfClass("Humanoid") and currentBall.Parent
        if ballOwnerChar and ballOwnerChar ~= char then
            local targetHRP = ballOwnerChar:FindFirstChild("HumanoidRootPart")
            if targetHRP then
                local dir = (targetHRP.Position - hrp.Position)
                if dir.Magnitude > 0.1 then
                    hum:Move(dir.Unit, false)
                end
            end
        end
    end
end) -- this end was missing before



-- GUI
local Window = Rayfield:CreateWindow({
    Name = "Ultimate Football Hub 2026",
    LoadingTitle = "Direct Path Logic Applied...",
    LoadingSubtitle = "by unknown",
    ConfigurationSaving = { Enabled = true },
    KeySystem = false
})

-- GUI Tabs
local PhysicsTab = Window:CreateTab("Player Physics", 4483362458)
local MagnetTab = Window:CreateTab("Player Magnet", 4483362458)
local HeadTab = Window:CreateTab("Head Mod & Boost", 4483362458)
local FlightTab = Window:CreateTab("Flight", 4483362458)
local RusherTab = Window:CreateTab("Auto Rusher", 4483362458)

-- Player Physics
PhysicsTab:CreateSection("Player Movement & Gravity")
PhysicsTab:CreateSlider({
    Name = "Gravity",
    Range = {1, 196.2},
    Increment = 1,
    CurrentValue = 196.2,
    Callback = function(v) workspace.Gravity = v end
})

PhysicsTab:CreateSlider({
    Name = "WalkSpeed",
    Range = {18, 200},
    Increment = 1,
    CurrentValue = defaultWalkSpeed,
    Callback = function(v)
        local hum = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum.WalkSpeed = v end
        defaultWalkSpeed = v
    end
})

PhysicsTab:CreateToggle({
    Name = "Noclip",
    CurrentValue = false,
    Callback = function(v)
        isNoclipEnabled = v
        if not v then
            local char = localPlayer.Character
            if char then
                for _, part in ipairs(char:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = true
                    end
                end
            end
        end
    end
})

-- Player Magnet
MagnetTab:CreateSection("Click-to-Pull Ball")
MagnetTab:CreateToggle({
    Name = "Enable Pull",
    CurrentValue = false,
    Callback = function(v) isMagEnabled = v end
})

MagnetTab:CreateSlider({
    Name = "Pull Strength",
    Range = {0.1, 1},
    Increment = 0.05,
    CurrentValue = 0.5,
    Callback = function(v) magRange = v end
})

-- Head Mod & Boost
HeadTab:CreateToggle({
    Name = "Enable Head Mod",
    CurrentValue = false,
    Callback = function(v)
        isHeadModEnabled = v
        -- Reset all heads if turned off
        if not v then
            for _, player in ipairs(Players:GetPlayers()) do
                if player.Character then
                    local head = player.Character:FindFirstChild("Head")
                    if head and head:FindFirstChild("OriginalY") then
                        head.Size = Vector3.new(1, head.OriginalY.Value, 1)
                        head.Transparency = 0
                        head.CanCollide = true
                    end
                end
            end
        end
    end
})

HeadTab:CreateSlider({
    Name = "Head Width (XZ)",
    Range = {1, 15},
    Increment = 0.5,
    CurrentValue = 5,
    Callback = function(v) targetHeadScale = v end
})

HeadTab:CreateToggle({
    Name = "Enable Boost Tech",
    CurrentValue = false,
    Callback = function(v) isBounceEnabled = v end
})

HeadTab:CreateSlider({
    Name = "Boost Power",
    Range = {30, 150},
    Increment = 5,
    CurrentValue = 50,
    Callback = function(v) bouncePower = v end
})

-- Flight
FlightTab:CreateSection("Flight")
FlightTab:CreateToggle({
    Name = "Enable Flight",
    CurrentValue = false,
    Callback = function(v)
        isFlying = v
        if not v then
            flyVelocity = Vector3.zero
            local hrp = localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart")
            if hrp then hrp.AssemblyLinearVelocity = Vector3.zero end
        end
    end
})

FlightTab:CreateSlider({
    Name = "Flight Speed",
    Range = {10, 200},
    Increment = 5,
    CurrentValue = 50,
    Callback = function(v) flySpeed = v end
})

-- Auto Rusher GUI
RusherTab:CreateSection("Auto Rusher")

RusherTab:CreateToggle({
    Name = "Enable Auto Rusher",
    CurrentValue = false,
    Callback = function(v)
        isAutoRusherEnabled = v
        local hum = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Humanoid")
        if not v and hum then
            -- Stop running animation
            for _, track in ipairs(hum:GetPlayingAnimationTracks()) do
                if track.Animation and track.Animation.Name == "AutoRusherAnim" then
                    track:Stop()
                    track.Animation:Destroy()
                end
            end
            -- Reset WalkSpeed
            hum.WalkSpeed = defaultWalkSpeed
            rusherHolding = false
        end
    end
})

-- Advanced Keybind Button
local currentAutoRusherKey = autoRusherKey

RusherTab:CreateButton({
    Name = "Set Auto Rusher Key",
    Callback = function()
        Rayfield:Notify({
            Title = "Auto Rusher",
            Content = "Press any key to assign Auto Rusher...",
            Duration = 3
        })

        local keyListener
        keyListener = UIS.InputBegan:Connect(function(input, gp)
            if gp then return end
            if input.UserInputType == Enum.UserInputType.Keyboard then
                currentAutoRusherKey = input.KeyCode
                autoRusherKey = input.KeyCode

                Rayfield:Notify({
                    Title = "Auto Rusher Keybind",
                    Content = "Auto Rusher now uses: " .. input.KeyCode.Name,
                    Duration = 3
                })

                keyListener:Disconnect()
            end
        end)
    end
})

UIS.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == currentAutoRusherKey then
        rusherHolding = true
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == currentAutoRusherKey then
        rusherHolding = false
    end
end)


-- AUTO RUSHER CORE
if isAutoRusherEnabled and rusherHolding and currentBall and currentBall.Parent then
    -- Check if the ball parent has a humanoid (player holding the ball)
    local ballParent = currentBall.Parent
    local ballOwnerHum = ballParent:FindFirstChildOfClass("Humanoid")
    
    if ballOwnerHum and ballParent ~= char then
        local targetHRP = ballParent:FindFirstChild("HumanoidRootPart")
        if targetHRP then
            -- Compute direction and move
            local dir = (targetHRP.Position - hrp.Position)
            if dir.Magnitude > 0.1 then
                hum:Move(dir.Unit, false)
            end
        end
    end
end


Rayfield:Notify({
    Title = "2026 Stable Loaded",
    Content = "Smooth Flight + XZ Head Scaling + Auto Rusher Ready.",
    Duration = 5
})
