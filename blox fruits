-- 2026 Secure Loader with Fail-Safe
getgenv().SecureMode = true 

local RayfieldLink = "https://raw.githubusercontent.com"
local success, Rayfield = pcall(function()
    return loadstring(game:HttpGet(RayfieldLink))()
end)

if not success or not Rayfield then
    warn("Rayfield failed to load. Ensure your executor supports loadstring and HttpGet.")
    return
end

local Window = Rayfield:CreateWindow({
   Name = "Ultimate Football Hub 2026",
   LoadingTitle = "Pull Logic & Head Fix Applied...",
   LoadingSubtitle = "2026 Stable Revision",
   ConfigurationSaving = { Enabled = false },
   KeySystem = false
})

-- TABS
local MainTab = Window:CreateTab("All Mods", 4483362458)

-- Variables
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local localPlayer = Players.LocalPlayer

local isHeadModEnabled, targetHeadScale = false, 1
local isMagEnabled, magRange, isMouseDown = false, 15, false
local visualSphere, currentBall = nil, nil

-- OPTIMIZATION: Search for ball every 0.5s
task.spawn(function()
    while task.wait(0.5) do
        currentBall = workspace:FindFirstChild("Football", true) or workspace:FindFirstChild("Ball", true)
    end
end)

-- Input Handling
UIS.InputBegan:Connect(function(input, gpe) 
    if not gpe and input.UserInputType == Enum.UserInputType.MouseButton1 then isMouseDown = true end 
end)
UIS.InputEnded:Connect(function(input) 
    if input.UserInputType == Enum.UserInputType.MouseButton1 then isMouseDown = false end 
end)

-- CORE LOGIC LOOP
RunService.Heartbeat:Connect(function()
    local char = localPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    -- 1. Football Magnet Logic (DIRECT PULL TO PLAYER)
    if currentBall and isMagEnabled then
        if not visualSphere then
            visualSphere = Instance.new("Part")
            visualSphere.Shape, visualSphere.Color = Enum.PartType.Ball, Color3.fromRGB(0, 255, 150)
            visualSphere.Transparency, visualSphere.Material = 0.6, Enum.Material.ForceField
            visualSphere.CanCollide, visualSphere.Anchored, visualSphere.CastShadow = false, true, false
            visualSphere.Parent = workspace
        end
        visualSphere.Size = Vector3.new(magRange * 0.8, magRange * 0.8, magRange * 0.8)
        visualSphere.Position = currentBall.Position

        if isMouseDown then 
            local dist = (hrp.Position - currentBall.Position).Magnitude
            if dist <= magRange then
                -- Calculate target 2 studs in front of player to "catch" it
                local targetPos = hrp.Position + (hrp.CFrame.LookVector * 2)
                local direction = (targetPos - currentBall.Position).Unit
                -- Apply strong velocity to pull the tool/ball directly to you
                currentBall.AssemblyLinearVelocity = (direction * 135)
            end
        end
    elseif visualSphere then
        visualSphere:Destroy()
        visualSphere = nil
    end

    -- 2. Integrated Persistent Head Collision Logic
    if isHeadModEnabled then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= localPlayer and player.Character then
                local head = player.Character:FindFirstChild("Head")
                local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
                
                if head and humanoid then
                    -- Visual Scaling
                    head.Size = Vector3.new(targetHeadScale, targetHeadScale, targetHeadScale)
                    head.Transparency = 0.5
                    
                    -- Collision Logic: Check if WE are standing on THEIR head
                    local isStandingOnHead = false
                    local rayParam = RaycastParams.new()
                    rayParam.FilterDescendantsInstances = {localPlayer.Character}
                    rayParam.FilterType = Enum.RaycastFilterType.Exclude
                    
                    -- Raycast down 5 studs from our HumanoidRootPart
                    local ray = workspace:Raycast(hrp.Position, Vector3.new(0, -5, 0), rayParam)
                    if ray and ray.Instance == head then
                        isStandingOnHead = true
                    end

                    -- Jump Logic + Persistent Stand Logic
                    local lastJump = humanoid:GetAttribute("LastJumpTime") or 0
                    local timeSinceJump = tick() - lastJump

                    -- If standing on head OR in the specific jump timing window, enable collision
                    if isStandingOnHead or (timeSinceJump > 0.15 and timeSinceJump < 0.30) then
                        head.CanCollide = true
                    else
                        head.CanCollide = false
                    end
                end
            end
        end
    end
end)

-- UI Setup
MainTab:CreateSection("Player")
MainTab:CreateSlider({Name = "WalkSpeed", Range = {18, 300}, Increment = 1, Suffix = "Speed", CurrentValue = 18, Callback = function(v) if localPlayer.Character:FindFirstChild("Humanoid") then localPlayer.Character.Humanoid.WalkSpeed = v end end})
MainTab:CreateSlider({Name = "Gravity", Range = {0, 196}, Increment = 1, Suffix = "Grav", CurrentValue = 196, Callback = function(v) workspace.Gravity = v end})

MainTab:CreateSection("Football Magnet")
MainTab:CreateToggle({Name = "Enable Mags", CurrentValue = false, Callback = function(v) isMagEnabled = v end})
MainTab:CreateSlider({Name = "Magnet Range", Range = {5, 100}, Increment = 1, Suffix = "Range", CurrentValue = 15, Callback = function(v) magRange = v end})

MainTab:CreateSection("Server Visuals")
MainTab:CreateToggle({Name = "Enable Head Size", CurrentValue = false, Callback = function(v) isHeadModEnabled = v end})
MainTab:CreateSlider({Name = "Head Scale", Range = {1, 15}, Increment = 0.5, CurrentValue = 1, Callback = function(v) targetHeadScale = v end})

Rayfield:Notify({Title = "Hub Loaded", Content = "Script fully operational for 2026.", Duration = 5})
